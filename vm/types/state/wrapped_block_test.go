package state

import (
	"encoding/hex"
	"testing"

	"github.com/stretchr/testify/require"

	"github.com/consideritdone/landslidevm/proto/vm"
	"github.com/consideritdone/landslidevm/utils/ids"
)

func TestGetCachedBlock(t *testing.T) {
	blockData := "0A81030A04080B10011211746573742D636861696E2D5538746537351802220C08929A9CB20610C88ECBC1012A480A20B36A211648CC884E0756EBCD822FC9DBDBF2093ED7AD2657659E8B5699C2890F122408011220C0F4664FF5641CE97A9D417DB130F44F391772F908092A76112944181872850A32205CFC76BB770AE729F8FCFF1BBC9BD6BFA9DD917E1714B3A5973B1F7B1B3057633A20A7A02E7CBB627D642622B06B4B51A227CC806382CF10333C84267C014DE307D04220F886C461EEC1C571508C865E60DED596B2560F7461501E9334BA135597AD9C854A20F886C461EEC1C571508C865E60DED596B2560F7461501E9334BA135597AD9C855220048091BC7DDC283F77BFBF91D73C44DA58C3DF8A9CBC867405D8B7F3DAADA22F5A0800000000000000006220E3B0C44298FC1C149AFBF4C8996FB92427AE41E4649B934CA495991B7852B8556A20E3B0C44298FC1C149AFBF4C8996FB92427AE41E4649B934CA495991B7852B8557214000000000000000000000000000000000000000012170A1571756572795F6B65793D71756572795F76616C75651A00225A1A02120022290803121427A081B935F841C87EB400A37BFA0E7DDC6897E71A0C08929A9CB20610F881CAC101220100222908031214E64417981307C18EB094B5AFA17DEE33165024501A0C08929A9CB20610E089CAC101220100"
	blockBytes, err := hex.DecodeString(blockData)
	require.NoError(t, err)
	blk, err := DecodeBlock(blockBytes)
	require.NoError(t, err)

	storage := NewWrappedBlocksStorage()
	testBlock1 := &WrappedBlock{
		Block:  blk,
		Status: vm.Status_STATUS_PROCESSING,
	}

	blkID, err := ids.ToID(blk.Hash())
	require.NoError(t, err)

	storage.UnverifiedBlocks.Put(blkID, testBlock1)

	wblk, ok := storage.GetCachedBlock(blkID)
	if !ok || wblk != testBlock1 {
		t.Errorf("GetCachedBlock() = %v, want %v", blk, testBlock1)
	}

	_, ok = storage.GetCachedBlock(ids.GenerateTestID()) // Заполните данными
	if ok {
		t.Errorf("GetCachedBlock() = %v, want %v", ok, false)
	}
}
